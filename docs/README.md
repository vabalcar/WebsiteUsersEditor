# WebsiteUsersEditor
WebsiteUsersEditor is a simple CLI written in PowerShell Core for batch managing website users in Virtualmin.

## Requirements
WebsiteUsersEditor is theoretically **multiplatform** thanks to the multiplatformity of **PowerShell Core** which it runs in. 
However, **zip**, **mysqldump**, **mysqlshow** and **chown** utilities are required to be installed in the target environment.
Properly configured **Virtualmin** with a virtual server running AMP (**Apache**, **MySQL**, and **PHP**) is also required.
If you intend to use Windows, WSL is highly recommended.

To sum it up, here's the list of everything you need to have installed and configured:
- [Powershell Core](https://github.com/PowerShell/PowerShell)
- [Virtualmin](https://www.virtualmin.com)
- [chown](https://linux.die.net/man/1/chown)
- [mysqldump](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html)
- [mysqlshow](https://dev.mysql.com/doc/refman/5.7/en/mysqlshow.html)
- [zip](https://linux.die.net/man/1/zip)

## Installation
Run following commands to install WebsiteUsersEditor from this repository:
```
git clone https://github.com/vabalcar/WebsiteUsersEditor.git WebsiteUsersEditor
cd WebsiteUsersEditor
cp DefaultSettings.json Settings.json # and edit Settings.json to configure WebsiteUsersEditor
```

## Configuration
The configuration is a JSON file containing a simple JSON dictionary with following key/value pairs:
- **domain**: Virtualmin's domain to use
- **serverUser**: Virtualmin's server admin user use
- **serverGroup**: Virtualmin's server admin group to use
- **apacheServerDocumentRoot**: Apache document root
- **websitesLocation**: URL path prefix; It's a path from apacheServerDocumentRoot to the directory in which WebsiteUsersEditor will create group directories
- **apacheUsersSettings**: a path to a directory from which Apache loads configuration; All configuration files generated by WebsiteUsersEditor will be stored there.
- **defaultUserPassword**: default password of newly created users
- **backupDir**: a path to a directory in which WebsiteUsersEditor will store backups


### Sample configuration file
```
{
    "domain": "example.com",
    "serverUser": "server",
    "serverGroup": "server",
    "apacheServerDocumentRoot": "/home/server/public_html",
    "websitesLocation": "websites",
    "apacheUsersSettings": "/etc/apache2/users-settings",
    "defaultUserPassword": "1234",
    "backupDir": "/home/server/backups"
}
```

## Usage

### List of users
Users are stored in a file in the user's name per line format like the following `sample-group.txt` file has:
```
tony.iommi
bill.ward
geezer.butler
ozzy.osbourne
```
Let's consider in following examples of usage of WebsiteUsersEditor that the `sample-group.txt` file is stored in the `usersLists` directory.

### Groups
Group is just a directory that contains home directories of some users. All groups are stored in a directory at **apacheServerDocumentRoot/websitesLocation** (see Configuration section).

### Create users
```
./Create-WebsiteUsers.ps1 < usersLists/sample-group.txt
```
creates users from the `usersLists/sample-group.txt` file in the group called `2020` by the `Settings.json` configuration file.

```
./Create-WebsiteUsers.ps1 -Group 'WebApps-2020' < usersLists/sample-group.txt
```
creates users from the `usersLists/sample-group.txt` file in the group called `WebApps-2020` by the `Settings.json` configuration file.

Create-WebsiteUsers.ps1 creates for each given user following:
- the user itself in the Virtualmin's virtual server
- the user's home directory
- the user's temp directory stored in the user's home directory
- the user's database with the almost same name like the user has (MySQL restrictions are applied during generation of the DB's name)
- security-related Apache and PHP configuration file stored in **apacheUsersSettings** (see Configuration section)

### Backup users
```
./Backup-WebsiteUsers.ps1 < usersLists/sample-group.txt
```
backups users from the `usersLists/sample-group.txt` file by the `Settings.json` configuration file.

Backup-WebsiteUsers.ps1 backups in **backupDir** for each given user following:
- the user's home directory to a zip file
- the user's database as a SQL script

### Remove users
```
./Remove-WebsiteUsers.ps1 < usersLists/sample-group.txt
```
removes users from the `usersLists/sample-group.txt` file by the `Settings.json` configuration file.

Remove-WebsiteUsers.ps1 removes everything that Create-WebsiteUsers.ps1 creates.

## License
The content of this repository is licensed under the [MIT License](https://github.com/vabalcar/WebsiteUsersEditor/blob/master/LICENSE.txt).